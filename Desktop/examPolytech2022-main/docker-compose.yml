volumes:
  mysql:
  
networks:
  java:


services:
  mysql:
    image: mysql:8
    volumes:
    - mysql:/var/lib/mysql
    networks:
      java:
        aliases:
        - mysql
    env_file:
    - .env
    healthcheck:
      test: ["CMD", "mysqladmin" ,"ping", "-h", "localhost"]
      interval: 5s
      timeout: 5s
      retries: 5
    
  java:
    image: java_ds:latest
    build: ./java
    networks:
        java:
            aliases:
            - java
    env_file:
    - .env
    ports:
    - 8448:8448
    depends_on:
      mysql:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "curl", "localhost:8448"]
      interval: 5s
      timeout: 5s
      retries: 5
    
  angular:
   image: angular:sans_sed
   build: ./angular
   environment:
   - BACKEND_URL_ENV_VAR=http://localhost:8448
   ports:
   - 80:80
   depends_on:
      java:
        condition: service_healthy
   healthcheck:
      test: ["CMD", "curl", "localhost:80"]
      interval: 5s
      timeout: 5s
      retries: 5



